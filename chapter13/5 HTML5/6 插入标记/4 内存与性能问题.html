<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="../../../index.css">
</head>

<body>
  <h1>内存与性能问题</h1>
  <p>使用本节介绍的方法替换子节点可能在浏览器中导致内存问题 。比如被移除的子树元素中之前有关联的时间处理程序或其他javascript 对象 (作为元素的属性) ,
    那它们之间的绑定关系会滞留在内存中 。 如果这种替换操作频繁发生，页面的内存占用就会持续攀升。在使用 innerHTML , outerHTML 和 insertAdjacentHTML() 之前
    , 最好手动删除要被替换的元素上关联的事件处理程序和 javascript对象 <strong>其实就是闭包嘛 , 词法环境被占用了 销毁不了</strong>
  </p>
  <p>使用这些属性当然有其方便之处，特别是innerHTML。一般来讲，插人大量的新HTML使用innerHTML 比使用多次DOM操作创建节点再插入来得更便捷。
    这是因为HTML解析器会解析设置编innerHm(或outerHTML)的值。解析器在浏览器中是底层代码(通常是C++代码)，比 javascript 快得多。 不过 , HTML
    解析器的构建与解构也不是没有代价 , 因此最好限制使用 innerHTML , 和 outerHTML 的次数 。比如 , 下面的代码使用 innerHTML 创建了一些列表项:
  </p>
  <code>
    <pre>
    const ul = document.querySelector('ul')
    const values = [1, 2, 3, 4, 5, 6, 7, 8, 9]

    for (let value of values) {
      ul.innerHTML += `&lt;li>${value}&lt;/li>`  // 千万不要这样做 !
    }
    </pre>
  </code>
  <ul></ul>
  <p>这段代码效率低 , 因为每次迭代都要设置一次 innerHTML 。 不仅如此 , 每次循环还要先读取innerHTML , 也就是说循环一次要访问两次 innerHTML 。 为此, 最好通过循环先构建一个独立的字符串 ,
    最后再一次性把生成的
    字符串赋值给 innerHTML , 比如
  </p>
  <code>
    <pre>
    let itemHtml = ''
    for (let value of values) {
      itemHtml += `&lt;li>${value}&lt;/li>`
    }

    ul.innerHTML = itemHtml
    </pre>
  </code>
  <p>这样修改之后效率就高多了，因为只有对innerHrML 的一次赋值。当然，像下面这样一行代码也可以实现:</p>
  <p class="retract">ul.innerHTML = values.map(value => `&lt;li>${value}&lt;/li>`).join('')</p>
  <strong>记住了要一次性将要添加的代码 添加到 innerHTML</strong>
  <script>
    const ul = document.querySelector('ul')
    const values = [1, 2, 3, 4, 5, 6, 7, 8, 9]

    // for (let value of values) {
    //   ul.innerHTML += `<li>${value}</li>`  // 千万不要这样做 !
    // }

    // let itemHtml = ''
    // for (let value of values) {
    //   itemHtml += `<li>${value}</li>`
    // }

    // ul.innerHTML = itemHtml

    ul.innerHTML = values.map(value => `<li>${value}</li>`).join('')
  </script>
</body>

</html>